define("tao/controller/routes",[],function(){return{Main:{actions:{index:"controller/main",getSectionActions:"controller/main/actions",getSectionTrees:"controller/main/trees"}},ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},Lists:{actions:{index:"controller/list/index"}}}}),define("tao/controller/list/index",["jquery","i18n","helpers","context"],function(t,e,n,i){return{start:function(){var a=n._url("saveLists","Lists","tao"),s=n._url("removeList","Lists","tao"),o=n._url("removeListElement","Lists","tao");t(".list-editor").click(function(){var s=t(this).attr("id").replace("list-editor_",""),r=t("div[id='list-data_"+s+"']");if(!r.parent().is("form")){r.wrap("<form class='listbox' />"),r.prepend("<input type='hidden' name='uri' value='"+s+"' />"),t("<input type='text' name='label' value='"+r.find("legend span").text()+"'/>").prependTo(r.find("div.list-elements")).keyup(function(){r.find("legend span").text(t(this).val())}),r.find(".list-element").length&&r.find(".list-element").replaceWith(function(){return"<input type='text' name='"+t(this).attr("id")+"' value='"+t(this).text()+"' />"});var l=r.find("ol");l.addClass("sortable-list"),l.find("li").addClass("ui-state-default"),l.find("li").prepend('<span class="ui-icon ui-icon-grip-dotted-vertical" ></span>'),l.find("li").prepend('<span class="ui-icon ui-icon-arrowthick-2-n-s" ></span>'),l.find("li").append('<span class="ui-icon ui-icon-circle-close list-element-deletor" style="cursor:pointer;" ></span>'),l.sortable({axis:"y",opacity:.6,placeholder:"ui-state-error",tolerance:"pointer",update:function(){var e={};t.each(t(this).sortable("toArray"),function(t,n){e[n]="list-element_"+(t+1)}),t(this).find("li").each(function(){var n=t(this).attr("id");if(e[n]){t(this).attr("id",e[n]);var i=t(this).find("input").attr("name").replace(n,e[n]);t(this).find("input").attr("name",i)}})}});var c=t("<a href='#'><img src='"+i.base_www+"img/save.png' class='icon' />"+e("Save")+"</a>");c.click(function(){t.postJson(a,t(this).parents("form").serializeArray(),function(t){t.saved&&(n.createInfoMessage(e("list saved")),n._load(n.getMainContainerSelector(),n._url("index","Lists","tao")))})}),l.after(c),l.after("<br />");var d=t("<a href='#'><img src='"+i.base_www+"img/add.png' class='icon' />"+e("New element")+"</a>");d.click(function(){var e=t(this).parent().find("ol").children().length+1;t(this).parent().find("ol").append("<li id='list-element_"+e+"' class='ui-state-default'><span class='ui-icon ui-icon-arrowthick-2-n-s' ></span><span class='ui-icon ui-icon-grip-dotted-vertical' ></span><input type='text' name='list-element_"+e+"_' /><span class='ui-icon ui-icon-circle-close list-element-deletor' ></span></li>")}),l.after(d)}t(".list-element-deletor").click(function(){if(confirm(e("Please confirm you want to delete this list element."))){var i=t(this).parent();s=i.find("input:text").attr("name").replace(/^list\-element\_([1-9]*)\_/,""),t.postJson(o,{uri:s},function(t){t.deleted&&(i.remove(),n.createInfoMessage(e("element deleted")))})}})}),t(".list-deletor").click(function(){if(confirm(e("Please confirm you want to delete this list. This operation is not reversible."))){var i=t(this).parents("div.listbox"),a=t(this).attr("id").replace("list-deletor_","");t.postJson(s,{uri:a},function(t){t.deleted&&(n.createInfoMessage(e("list deleted")),i.remove())})}})}}}),define("controller/main/toolbar",["jquery"],function(t){var e=t("#main-menu > .right-menu"),n={setUp:function(){e.find("[data-action]").click(function(){var e=t(this),n=e.data("action");require([n],function(t){t&&"function"==typeof t.start&&t.start()})})}};return n}),define("tao/controller/main",["uiBootstrap","helpers","uiForm","generis.actions","controller/main/toolbar"],function(t,e,n,i,a){return{start:function(){t.init(),e.init(),n.init(),i.init(),a.setUp()}}}),define("tao/controller/main/actions",["module","uiBootstrap"],function(t,e){return{start:function(){e.initNav()}}}),define("tao/controller/main/toolbar",["jquery"],function(t){var e=t("#main-menu > .right-menu"),n={setUp:function(){e.find("[data-action]").click(function(){var e=t(this),n=e.data("action");require([n],function(t){t&&"function"==typeof t.start&&t.start()})})}};return n}),define("tao/controller/main/trees",["jquery","lodash","helpers","generis.tree.browser","generis.actions","module"],function(t,e,n,i,a,s){return{start:function(){var t=s.config().sectionTreesData;if(t)for(var o in t){var r=e.defaults(t[o],{formContainer:n.getMainContainerSelector(),actionId:o,paginate:30}),l=new i("#tree-"+o,r.dataUrl,r);a.setMainTree(l)}}}}),define("tao/controller/settings/extensionManager",["jquery","i18n","context","helpers"],function(t,e,n,i){function a(e){var n=[];return t("#"+e+" .dependencies li:not(.installed)").each(function(){var e=t(this).attr("rel"),i=a(e);i.push(e),n=n.concat(i)}),n}function s(e){for(var n=[],i=0;i<e.length;i++)t.inArray(e[i],n)<0&&n.push(e[i]);return n}function o(e){t("#installProgress .console").append("<p>"+e+"</p>"),t("#installProgress .console").prop({scrollTop:t("#installProgress .console").prop("scrollHeight")})}function r(){var a=p[f];t("#installProgress p.status").text(e("Installing extension %s...").replace("%s",a)),o(e("Installing extension %s...").replace("%s",a)),t.ajax({type:"POST",url:n.root_url+"tao/ExtensionsManager/install",data:"id="+a,dataType:"json",success:function(n){i.loaded(),n.success?(o(e("> Extension %s succesfully installed.").replace("%s",a)),t("li.ext-id.ext-"+a).addClass("installed"),t("tr#"+a).slideUp("normal",function(){var e=t("<tr></tr>").appendTo(t("#extensions-manager-container tbody")).hide(),n=t("tr#"+a+" td");e.append('<td class="bordered">'+t(n[0]).text()+"</td>"),e.append('<td class="bordered">'+t(n[1]).text()+"</td>"),e.append("<td>"+t(n[2]).text()+"</td>"),e.slideDown("normal",function(){t("tr#"+a).remove(),c(),0==t("#available-extensions-container table tbody tr").length&&d(),t("#installProgress .bar").animate({width:"+="+h+"%"},1e3,function(){f++,l()})})})):(m=1,o("Installation of "+a+" failed")),i.createInfoMessage(n.message)}}),m&&o(e("A fatal error occured during the installation process."))}function l(){f>=p.length?(p=[],t("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),o(e("Generating cache...")),t.ajax({type:"GET",url:t(t("#main-menu a")[0]).prop("href"),success:function(){i.loaded(),t("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),t("#installProgress p.status").text(e("Installation done.")),o(e("> Installation done."))}})):r()}function c(){t("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),t("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),t("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")}function d(){var n=t("<div/>");n.attr("id","noExtensions").addClass("ui-state-highlight").text(e("No extensions available.")),t("#available-extensions-container").empty().append(n)}var u=[],p=[],f=-1,h=0,m=0;return{start:function(){c(),t("#installProgress").hide(),t("#extensions-manager-container .ext-id").each(function(){var e=t(this).text();u.push(e),t(".ext-id.ext-"+e).addClass("installed")}),t("#available-extensions-container tr input").click(function(t){t.stopPropagation()}),t("#available-extensions-container tr input:checkbox").click(function(){var e=t("#installButton");t(this).parent().parent().parent().find("input:checkbox:checked").length>0?e.attr("disabled",!1):e.attr("disabled",!0)}),t("#available-extensions-container form").submit(function(n){return p=[],t("#available-extensions-container input:checked").each(function(){var e=t(this).prop("name").split("_")[1],n=a(e);n.length&&(p=p.concat(n)),p.push(e)}),p=s(p),0==p.length?(alert(e("Nothing to install !")),!1):(h=100/p.length,t("#installProgress p.status").text(e("%s extension(s) to install.").replace("%s",p.length)),t("#installProgress .bar").width(0),t("#installProgress .console").empty(),o(e("Do you wish to install the following extension(s):\n%s?").replace("%s",p.join(", "))),t("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:e("No"),click:function(){t(this).dialog("close")}},{text:e("Yes"),click:function(){o(e("Preparing installation...")),t(".ui-dialog-buttonpane").remove(),m=0,f=0,r()}}]}),void n.preventDefault())})}}});