define("funcAcl/controller/routes",[],function(){return{Admin:{actions:{index:"controller/acl"}}}}),define("funcAcl/controller/acl",["jquery","context","i18n"],function(s,a,c){function l(e,l){s("#aclModules ul.group-list").empty(),s("#aclActions ul.group-list").empty(),""!==e&&s.ajax({type:"POST",url:a.root_url+"funcAcl/Admin/getModules",data:"role="+e,dataType:"json",success:function(a){for(var e in a){var i=a[e],r="";i["has-access"]?r=" has-access":i["has-allaccess"]&&(r=" has-allaccess");var u=c(i["has-access"]||i["has-allaccess"]?"Revoke access rights to the entire extension":"Grant access rights to the entire extension"),d=s('<li class="group expendable closed'+r+'"><div class="group-title"><span class="ui-icon ui-icon-triangle-1-e"/><span class="title">'+e+'</span><span class="selector all checkable" title="'+u+'"></span></div><ul></ul></li>');d.acldata("uri",i.uri),s(".selector",d).click(1==i["has-access"]?function(a){a.stopPropagation(),n(s(this))}:1==i["has-allaccess"]?function(a){a.stopPropagation(),n(s(this))}:function(a){a.stopPropagation(),o(s(this))}),s(".group-title",d).click(function(){s(this).parent().hasClass("open")?(s(this).removeClass("open"),s(this).parent().removeClass("open").addClass("closed"),s(this).find(".ui-icon").removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e"),s(this).parent().find(".selected").removeClass("selected")):(s(this).addClass("open"),s(this).parent().removeClass("closed").addClass("open"),s(this).find(".ui-icon").removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s"))});for(var p in i.modules){var h=i.modules[p],r="";h["has-access"]?r=" has-access":h["has-allaccess"]&&(r=" has-allaccess");var f=c(h["has-access"]||h["has-allaccess"]?"Revoke access rights to the entire module":"Grant access rights to the entire module"),g=s('<li class="selectable'+r+'"><span class="label">'+p+'</span><span class="selector checkable" title="'+f+'"></span></li>');g.acldata("uri",h.uri),s(".selector",g).click(h["has-access"]?function(a){a.stopPropagation(),o(s(this))}:h["has-allaccess"]?function(a){a.stopPropagation(),n(s(this))}:function(a){a.stopPropagation(),o(s(this))}),g.click(function(){s("#aclModules .selectable").removeClass("selected"),s(this).addClass("selected"),t(s("#roles").val(),s(this).acldata("uri"))}),g.appendTo(s("ul",d))}d.appendTo(s("#aclModules ul.group-list"))}"undefined"!=typeof l&&l()}})}function t(l,t,i){s.ajax({type:"POST",url:a.root_url+"funcAcl/Admin/getActions",data:"role="+l+"&module="+t,dataType:"json",success:function(a){s("#aclActions ul.group-list").empty();var l=0;for(e in a){var t=a[e],r="";(t["has-allaccess"]||t["has-access"])&&(r=" has-allaccess",l++);var u=c(" has-allaccess"===r?"Revoke access rights to the action":"Grant access rights to the action"),d=s('<li class="selectable'+r+'"><span class="label">'+e+'</span><span class="selector checkable" title="'+u+'"></span></li>');d.acldata("uri",t.uri),s(".selector",d).click(d.hasClass("has-allaccess")?function(a){a.stopPropagation(),n(s(this))}:function(a){a.stopPropagation(),o(s(this))}),d.click(function(){s("#aclActions .selectable").removeClass("selected"),s(this).toggleClass("selected")}),d.appendTo(s("#aclActions ul.group-list"))}"undefined"!=typeof i&&i()}})}function o(a){var e=s(a).closest("li").removeClass("has-access").addClass("has-allaccess").acldata("uri");i(e,"add",s("#roles").val()),a.unbind("click").click(function(a){a.stopPropagation(),n(s(this))})}function n(a){var e=s(a).closest("li").removeClass("has-access").removeClass("has-allaccess").acldata("uri");i(e,"remove",s("#roles").val()),a.unbind("click").click(function(a){a.stopPropagation(),o(s(this))})}function i(e,c,o){var n=e.split("#")[1].split("_")[0],i="";switch(n){case"e":i="Extension";break;case"m":i="Module";break;case"a":i="Action"}switch(c){case"add":i="add"+i+"Access";break;case"remove":i="remove"+i+"Access";break;case"mod2act":i="moduleTo"+i+"Access";break;case"mod2acts":i="moduleToActionsAccess";break;case"acts2mod":i="actionsToModuleAccess"}s.ajax({type:"POST",url:a.root_url+"funcAcl/Admin/"+i,data:"role="+o+"&uri="+e,dataType:"json",success:function(){var a,c=s("#aclModules .group.expendable.open").index(),o=s("#aclModules .selected");o.length?(e=o.acldata("uri"),a=o.index()):a=-1,l(s("#roles").val(),function(){c>=0&&s("#aclModules .group.expendable:eq("+c+")").removeClass("closed").addClass("open").find(".group-title").addClass("open"),a>=0&&(s("#aclModules .open li:eq("+a+")").addClass("selected"),t(s("#roles").val(),e))})}})}return s.fn.acldata=function(a,e){return"undefined"!=typeof e&&(s.expr.attrHandle[a]=function(e){return s(e).attr(a)||s(e).data(a)}),s.fn.data.apply(this,arguments)},{start:function(){s("#roles").change(function(){""===s("#roles").val()?s("#roleactions").hide():s("#roleactions").show(),l(s("#roles").val())}).change()}}});